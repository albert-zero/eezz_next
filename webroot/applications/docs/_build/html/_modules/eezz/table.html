

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>eezz.table &mdash; EEZZ 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            EEZZ
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">eezz</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">EEZZ</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">eezz.table</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for eezz.table</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/python3</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This module implements the following classes:</span>

<span class="sd">    * :py:class:`eezz.table.TTableCell`:        Defines properties of a table cell</span>
<span class="sd">    * :py:class:`eezz.table.TTableCellDetail`:  Defines a list of cell details, used to store multiple values</span>
<span class="sd">    * :py:class:`eezz.table.TTableRow`:         Defines properties of a table row, containing a list of TTableCells</span>
<span class="sd">    * :py:class:`eezz.table.TTableColumn`:      Defines properties of a table column</span>
<span class="sd">    * :py:class:`eezz.table.TTable`:            Defines properties of a table, containing a list of TTableRows</span>
<span class="sd">    * :py:class:`eezz.table.TTableException`:   Exception on checking the row-id, which has to be unique</span>

<span class="sd">    TTable is used for formatted ASCII output of a table structure.</span>
<span class="sd">    It allows to access the table data for further processing e.g. for HTML output. The class handles an</span>
<span class="sd">    internal read cursor, which allows to navigate in the list of rows and to read a fixed amount of rows.</span>

<span class="sd">    TTable is a list of TTableRow objects, each of which is a list of TCell objects.</span>
<span class="sd">    The TTableColumn holds the as well column names as types and is used to organize sort and filter.</span>
<span class="sd">    A TTableCell object could hold a TTable object for recursive tree structures.</span>

<span class="sd">    Besides this the following enumerations are used</span>

<span class="sd">    * :py:class:`eezz.table.TNavigation`:   Enumeration for method :py:meth:`eezz.table.TTable.navigate`</span>
<span class="sd">    * :py:class:`eezz.table.TSort`:         Enumeration for method :py:meth:`eezz.table.TTable.do_sort`</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span>  <span class="nn">itertools</span>
<span class="kn">import</span>  <span class="nn">os</span>
<span class="kn">import</span>  <span class="nn">io</span>
<span class="kn">import</span>  <span class="nn">re</span>
<span class="kn">import</span>  <span class="nn">sys</span>
<span class="kn">from</span>    <span class="nn">collections.abc</span>  <span class="kn">import</span> <span class="n">Callable</span>
<span class="kn">from</span>    <span class="nn">collections</span> <span class="kn">import</span> <span class="n">UserList</span>
<span class="kn">from</span>    <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span>    <span class="nn">itertools</span>   <span class="kn">import</span> <span class="n">filterfalse</span>
<span class="kn">from</span>    <span class="nn">typing</span>      <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">NewType</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">from</span>    <span class="nn">enum</span>        <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span>    <span class="nn">pathlib</span>     <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span>    <span class="nn">datetime</span>    <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>
<span class="kn">from</span>    <span class="nn">copy</span>        <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span>    <span class="nn">Crypto.Hash</span> <span class="kn">import</span> <span class="n">SHA1</span>

<span class="kn">from</span>    <span class="nn">service</span>     <span class="kn">import</span> <span class="n">TService</span>
<span class="kn">from</span>    <span class="nn">threading</span>   <span class="kn">import</span> <span class="n">Condition</span><span class="p">,</span> <span class="n">Lock</span>
<span class="kn">import</span>  <span class="nn">sqlite3</span>
<span class="kn">from</span>    <span class="nn">loguru</span>      <span class="kn">import</span> <span class="n">logger</span>


<span class="k">class</span> <span class="nc">TTableException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; The table exception: trying to insert a double row-id &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>


<div class="viewcode-block" id="TNavigation">
<a class="viewcode-back" href="../../eezz.html#eezz.table.TNavigation">[docs]</a>
<span class="k">class</span> <span class="nc">TNavigation</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Elements to describe navigation events for method :py:func:`eezz.table.TTable.navigate`. The navigation is</span>
<span class="sd">    organized in chunks of rows given by property</span>
<span class="sd">    :ref:`TTable.visible_items &lt;ttable_parameter_list&gt;`:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ABS</span>     <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Request an absolute position in the dataset&#39;</span>
    <span class="n">NEXT</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Set the cursor to show the next chunk of rows&#39;</span>
    <span class="n">PREV</span>    <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Set the cursor to show the previous chunk of rows&#39;</span>
    <span class="n">TOP</span>     <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Set the cursor to the first row&#39;</span>
    <span class="n">LAST</span>    <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Set the cursor to show the last chunk of rows&#39;</span></div>



<div class="viewcode-block" id="TSort">
<a class="viewcode-back" href="../../eezz.html#eezz.table.TSort">[docs]</a>
<span class="k">class</span> <span class="nc">TSort</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; sorting order for a table column. &quot;&quot;&quot;</span>
    <span class="n">NONE</span>    <span class="o">=</span> <span class="mi">0</span>             <span class="c1">#: :meta private:</span>
    <span class="n">ASC</span>     <span class="o">=</span> <span class="mi">1</span>             <span class="c1">#: :meta private:</span>
    <span class="n">DESC</span>    <span class="o">=</span> <span class="mi">2</span>             <span class="c1">#: :meta private:</span></div>



<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">TTableCellDetail</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Container for TTableCell details &quot;&quot;&quot;</span>
    <span class="n">value</span><span class="p">:</span>  <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>      <span class="c1">#: :meta private:</span>
    <span class="n">source</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>      <span class="c1">#: :meta private:</span>


<div class="viewcode-block" id="TTableCell">
<a class="viewcode-back" href="../../eezz.html#eezz.table.TTableCell">[docs]</a>
<span class="nd">@dataclass</span><span class="p">(</span><span class="n">kw_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TTableCell</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Represents a table cell with properties such as name, value, width, index,</span>
<span class="sd">    type, and additional user-defined attributes. This class is used to store</span>
<span class="sd">    and manage the properties of a single cell within a table structure. It</span>
<span class="sd">    provides default values for width, index, type, and allows the inclusion</span>
<span class="sd">    of custom attributes if necessary.</span>

<span class="sd">    :ivar str name:     Name of the column.</span>
<span class="sd">    :ivar Any value:    Value of the cell.</span>
<span class="sd">    :ivar int width:    Calculated width of a cell.</span>
<span class="sd">    :ivar int index:    Calculated index of a cell.</span>
<span class="sd">    :ivar str type:     Calculated type (could also be user defined).</span>
<span class="sd">    :ivar dict attrs:   User attributes.</span>
<span class="sd">    :ivar details:  List of values, which could be used to address objects of the same kind.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span>   <span class="nb">str</span>                     <span class="c1">#: :meta private: Name of the column</span>
    <span class="n">value</span><span class="p">:</span>  <span class="n">Any</span>                     <span class="c1">#: :meta private: Value of the cell</span>
    <span class="n">width</span><span class="p">:</span>  <span class="nb">int</span>         <span class="o">=</span> <span class="mi">10</span>        <span class="c1">#: :meta private: calculated width of a cell</span>
    <span class="n">index</span><span class="p">:</span>  <span class="nb">int</span>         <span class="o">=</span> <span class="mi">0</span>         <span class="c1">#: :meta private: calculated index of a cell</span>
    <span class="nb">type</span><span class="p">:</span>   <span class="nb">str</span>         <span class="o">=</span> <span class="s1">&#39;str&#39;</span>     <span class="c1">#: :meta private: calculated type (could also be user defined)</span>
    <span class="n">attrs</span><span class="p">:</span>  <span class="nb">dict</span>        <span class="o">=</span> <span class="kc">None</span>      <span class="c1">#: :meta private: user attributes</span>
    <span class="n">details</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TTableCellDetail</span><span class="p">]</span>  <span class="o">=</span> <span class="kc">None</span>      <span class="c1">#: :meta private: detail list of dict</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; :meta private: &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">details</span>

    <span class="nd">@detail</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; :meta private: &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">details</span> <span class="o">=</span> <span class="p">[</span><span class="n">TTableCellDetail</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span></div>



<div class="viewcode-block" id="TTableColumn">
<a class="viewcode-back" href="../../eezz.html#eezz.table.TTableColumn">[docs]</a>
<span class="nd">@dataclass</span><span class="p">(</span><span class="n">kw_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TTableColumn</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;  Represents a column in a table with customizable properties.</span>

<span class="sd">    This class is designed to encapsulate the properties and behaviors of a</span>
<span class="sd">    table column, offering options to set and modify its header, attributes,</span>
<span class="sd">    index, width, alias, sorting preference, data type, and filtering</span>
<span class="sd">    criteria. It is typically used in table structures where columns may need</span>
<span class="sd">    specific customization for display or processing.</span>

<span class="sd">    :ivar header:   Name of the column.</span>
<span class="sd">    :type header:   str</span>
<span class="sd">    :ivar attrs:    Customizable attributes of the column.</span>
<span class="sd">    :type attrs:    dict</span>
<span class="sd">    :ivar index:    Calculated index of the column.</span>
<span class="sd">    :type index:    int</span>
<span class="sd">    :ivar width:    Calculated width of the column.</span>
<span class="sd">    :type width:    int</span>
<span class="sd">    :ivar alias:    Alias name for output.</span>
<span class="sd">    :type alias:    str</span>
<span class="sd">    :ivar sort:     Sort direction of the column.</span>
<span class="sd">    :type sort:     bool</span>
<span class="sd">    :ivar type:     Type of the column.</span>
<span class="sd">    :type type:     str</span>
<span class="sd">    :ivar filter:   Filter string.</span>
<span class="sd">    :type filter:   str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">header</span><span class="p">:</span>     <span class="nb">str</span>                 <span class="c1">#: :meta private: Name of the column</span>
    <span class="n">attrs</span><span class="p">:</span>      <span class="nb">dict</span>    <span class="o">=</span> <span class="kc">None</span>      <span class="c1">#: :meta private: Customizable attributes of the column</span>
    <span class="n">index</span><span class="p">:</span>      <span class="nb">int</span>     <span class="o">=</span> <span class="mi">0</span>         <span class="c1">#: :meta private: Calculated index of the column</span>
    <span class="n">width</span><span class="p">:</span>      <span class="nb">int</span>     <span class="o">=</span> <span class="mi">10</span>        <span class="c1">#: :meta private: Calculated width of the column</span>
    <span class="n">alias</span><span class="p">:</span>      <span class="nb">str</span>     <span class="o">=</span> <span class="s1">&#39;&#39;</span>        <span class="c1">#: :meta private: Alias name for output</span>
    <span class="n">sort</span><span class="p">:</span>       <span class="nb">bool</span>    <span class="o">=</span> <span class="kc">True</span>      <span class="c1">#: :meta private: Sort direction of the column</span>
    <span class="nb">type</span><span class="p">:</span>       <span class="nb">str</span>     <span class="o">=</span> <span class="s1">&#39;str&#39;</span>     <span class="c1">#: :meta private: Type of the column</span>
    <span class="nb">filter</span><span class="p">:</span>     <span class="nb">str</span>     <span class="o">=</span> <span class="kc">None</span>      <span class="c1">#: :meta private: Filter string</span></div>



<span class="c1"># forward declaration</span>
<span class="n">TTable</span> <span class="o">=</span> <span class="n">NewType</span><span class="p">(</span><span class="s1">&#39;TTable&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>


<div class="viewcode-block" id="TTableRow">
<a class="viewcode-back" href="../../eezz.html#eezz.table.TTableRow">[docs]</a>
<span class="nd">@dataclass</span><span class="p">(</span><span class="n">kw_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TTableRow</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a table row, capable of handling both simple and complex table structures.</span>

<span class="sd">    The TTableRow class is designed to facilitate the management and manipulation of table</span>
<span class="sd">    rows, allowing for both straightforward data representation and handling of more complex</span>
<span class="sd">    recursive data structures within a table. This class supports automatic conversion of</span>
<span class="sd">    string lists into cells and provides properties for interacting with row elements by column</span>
<span class="sd">    name or index.</span>

<span class="sd">    :ivar cells:        A list of TTableCell objects or strings. Strings are automatically converted</span>
<span class="sd">                        into TTableCell objects during initialization.</span>
<span class="sd">    :ivar cells_filter: Filtered cells used for re-ordering and alias names, intended for</span>
<span class="sd">                        internal use only.</span>
<span class="sd">    :ivar column_descr: The column descriptor holds the attributes of the columns.</span>
<span class="sd">    :ivar index:        Unique address for the columns, intended for internal use only.</span>
<span class="sd">    :ivar row_id:       Unique row id of the row, valid for the entire table, intended for internal</span>
<span class="sd">                        use only.</span>
<span class="sd">    :ivar child:        A row could handle recursive data structures, intended for internal use only.</span>
<span class="sd">    :ivar type:         Customizable type used for triggering template output, intended for internal</span>
<span class="sd">                        use only.</span>
<span class="sd">    :ivar attrs:        Customizable row attributes, intended for internal use only.</span>
<span class="sd">    :type cells:        List[TTableCell] | List[str]</span>
<span class="sd">    :type cells_filter: List[TTableCell]</span>
<span class="sd">    :type column_descr: List[str]</span>
<span class="sd">    :type index:        int</span>
<span class="sd">    :type row_id:       str</span>
<span class="sd">    :type child:        TTable</span>
<span class="sd">    :type type:         str</span>
<span class="sd">    :type attrs:        dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cells</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TTableCell</span><span class="p">]</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>  <span class="c1">#: :meta private: A list of strings are converted to a list of TTableCells</span>
    <span class="n">cells_filter</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TTableCell</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1">#: :meta private: Filtered cells used for re-ordering and alias names.</span>
    <span class="n">column_descr</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>      <span class="c1">#: :meta private: The column descriptor holds the attributes of the columns</span>
    <span class="n">index</span><span class="p">:</span>      <span class="nb">int</span>         <span class="o">=</span> <span class="kc">None</span>      <span class="c1">#: :meta private: Unique address for the columns</span>
    <span class="n">row_id</span><span class="p">:</span>     <span class="nb">str</span>         <span class="o">=</span> <span class="kc">None</span>      <span class="c1">#: :meta private: Unique row id of the row, valid for the entire table</span>
    <span class="n">child</span><span class="p">:</span>      <span class="n">TTable</span>      <span class="o">=</span> <span class="kc">None</span>      <span class="c1">#: :meta private: A row could handle recursive data structures</span>
    <span class="nb">type</span><span class="p">:</span>       <span class="nb">str</span>         <span class="o">=</span> <span class="s1">&#39;body&#39;</span>    <span class="c1">#: :meta private: Customizable type used for triggering template output</span>
    <span class="n">attrs</span><span class="p">:</span>      <span class="nb">dict</span>        <span class="o">=</span> <span class="kc">None</span>      <span class="c1">#: :meta private: Customizable row attributes</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Computes the SHA1 hash of the `row_id` attribute encoded in UTF-8.</span>

<span class="sd">        This property provides a unique string identifier for an object by</span>
<span class="sd">        hashing its `row_id` attribute. This can be particularly useful for</span>
<span class="sd">        ensuring consistent, non-collision identifiers across distributed systems</span>
<span class="sd">        or unique object tracking.</span>

<span class="sd">        :return: The SHA1 hash of the `row_id` as a hexadecimal string.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SHA1</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_id</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a row, converting the values to :py:obj:`eezz.table.TTableCell` &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">)</span> <span class="ow">is</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cells</span> <span class="o">=</span> <span class="p">[</span><span class="n">TTableCell</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">column_descr</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<div class="viewcode-block" id="TTableRow.get_values_list">
<a class="viewcode-back" href="../../eezz.html#eezz.table.TTableRow.get_values_list">[docs]</a>
    <span class="k">def</span> <span class="nf">get_values_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves a list of values from the cells.</span>

<span class="sd">        This method iterates over the cells and extracts their values into a list.</span>

<span class="sd">        :return: A list containing values of the cells.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">]</span></div>


    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Allows field access: value = row[column] &quot;&quot;&quot;</span>
        <span class="n">x_inx</span> <span class="o">=</span> <span class="n">column</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">column</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_descr</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">x_inx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Allows field access: r[column] = value &quot;&quot;&quot;</span>
        <span class="n">x_inx</span> <span class="o">=</span> <span class="n">column</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">column</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_descr</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">x_inx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span></div>



<div class="viewcode-block" id="TTable">
<a class="viewcode-back" href="../../eezz.html#eezz.table.TTable">[docs]</a>
<span class="nd">@dataclass</span><span class="p">(</span><span class="n">kw_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TTable</span><span class="p">(</span><span class="n">UserList</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; The table extends UserList to enable list management and inherits methods like sort</span>
<span class="sd">    This class is decorated as dataclass</span>

<span class="sd">    .. _ttable_parameter_list:</span>

<span class="sd">    :param column_names:    List of names for each column</span>
<span class="sd">    :type  column_names:    List[str]</span>
<span class="sd">    :param title:           Table name and title</span>
<span class="sd">    :type  title:           str</span>

<span class="sd">    :ivar Dict[str, Callable[size, value]] format_types: A map for types and format rules.</span>
<span class="sd">        The callable takes two variables, the width and the value.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Table instance:</span>

<span class="sd">        &gt;&gt;&gt; from table import TTable</span>
<span class="sd">        &gt;&gt;&gt; my_table = TTable(column_names=[&#39;FileName&#39;, &#39;Size&#39;], title=&#39;Directory&#39;)</span>
<span class="sd">        &gt;&gt;&gt; # for file in Path(&#39;.&#39;).iterdir():</span>
<span class="sd">        &gt;&gt;&gt; #    my_table.append(table_row=[file, file.stat().st_size])</span>
<span class="sd">        &gt;&gt;&gt; row1 = my_table.append(table_row=[&#39;.idea&#39;,        4096])</span>
<span class="sd">        &gt;&gt;&gt; row2 = my_table.append(table_row=[&#39;directory.py&#39;, 1699])</span>
<span class="sd">        &gt;&gt;&gt; row3 = my_table.append(table_row=[&#39;__init__.py&#39;,    37])</span>
<span class="sd">        &gt;&gt;&gt; row4 = my_table.append(table_row=[&#39;__pycache__&#39;,  4096])</span>
<span class="sd">        &gt;&gt;&gt; debug_out = io.StringIO()</span>
<span class="sd">        &gt;&gt;&gt; my_table.print(file=debug_out)</span>
<span class="sd">        &gt;&gt;&gt; print(debug_out.getvalue()[:-1])</span>
<span class="sd">        Table: Directory</span>
<span class="sd">        | FileName     | Size |</span>
<span class="sd">        | .idea        | 4096 |</span>
<span class="sd">        | directory.py | 1699 |</span>
<span class="sd">        | __init__.py  |   37 |</span>
<span class="sd">        | __pycache__  | 4096 |</span>


<span class="sd">        This is a possible extension of a format for type iban, breaking the string into chunks of 4:</span>

<span class="sd">        &gt;&gt;&gt; iban = &#39;de1212341234123412&#39;</span>
<span class="sd">        &gt;&gt;&gt; my_table.format_types[&#39;iban&#39;] = lambda x_size, x_val: f&quot;{(&#39; &#39;.join(re.findall(&#39;.{1,4}&#39;, x_val))):&gt;{x_size}}&quot;</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;{my_table.format_types[&#39;iban&#39;](30, iban)}&quot;)</span>
<span class="sd">                de12 1234 1234 1234 12</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">column_names</span><span class="p">:</span>       <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>                       <span class="c1">#: :meta private: List of column names</span>
    <span class="n">title</span><span class="p">:</span>              <span class="nb">str</span>         <span class="o">=</span> <span class="s1">&#39;TTable&#39;</span>          <span class="c1">#: :meta private: Table title name</span>
    <span class="n">column_names_map</span><span class="p">:</span>   <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TTableCell</span><span class="p">]</span>   <span class="o">=</span> <span class="kc">None</span>  <span class="c1">#: :meta private: Map name to columns</span>
    <span class="n">column_names_alias</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>          <span class="o">=</span> <span class="kc">None</span>  <span class="c1">#: :meta private: Translated column names</span>
    <span class="n">column_names_filter</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>              <span class="o">=</span> <span class="kc">None</span>  <span class="c1">#: :meta private: Index for shuffle columns</span>
    <span class="n">column_descr</span><span class="p">:</span>       <span class="n">List</span><span class="p">[</span><span class="n">TTableColumn</span><span class="p">]</span>      <span class="o">=</span> <span class="kc">None</span>  <span class="c1">#: :meta private: Describes each column</span>
    <span class="n">table_index</span><span class="p">:</span>        <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TTableRow</span><span class="p">]</span>    <span class="o">=</span> <span class="kc">None</span>  <span class="c1">#: :meta private: Table unique row index</span>
    <span class="n">attrs</span><span class="p">:</span>              <span class="nb">dict</span>        <span class="o">=</span> <span class="kc">None</span>              <span class="c1">#: :meta private: User attributes</span>
    <span class="n">visible_items</span><span class="p">:</span>      <span class="nb">int</span>         <span class="o">=</span> <span class="mi">20</span>                <span class="c1">#: :meta private: Number of items to show</span>
    <span class="n">offset</span><span class="p">:</span>             <span class="nb">int</span>         <span class="o">=</span> <span class="mi">0</span>                 <span class="c1">#: :meta private: Offset for sequence reading</span>
    <span class="n">selected_row</span><span class="p">:</span>       <span class="n">TTableRow</span>   <span class="o">=</span> <span class="kc">None</span>              <span class="c1">#: :meta private: Selected row</span>
    <span class="n">header_row</span><span class="p">:</span>         <span class="n">TTableRow</span>   <span class="o">=</span> <span class="kc">None</span>              <span class="c1">#: :meta private: Header row of the table</span>
    <span class="n">apply_filter_column</span><span class="p">:</span> <span class="nb">bool</span>       <span class="o">=</span> <span class="kc">False</span>             <span class="c1">#: :meta private: If true columns are reordered and translated</span>
    <span class="n">format_types</span><span class="p">:</span>       <span class="nb">dict</span>        <span class="o">=</span> <span class="kc">None</span>              <span class="c1">#: :meta private: Map output format for value type</span>
    <span class="n">async_condition</span><span class="p">:</span>    <span class="n">Condition</span>   <span class="o">=</span> <span class="n">Condition</span><span class="p">()</span>       <span class="c1">#: :meta private: Used for async access to table</span>
    <span class="n">async_lock</span><span class="p">:</span>         <span class="n">Lock</span>        <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>            <span class="c1">#: :meta private: Used for async access to table values</span>
    <span class="n">database_path</span><span class="p">:</span>      <span class="nb">str</span>         <span class="o">=</span> <span class="s1">&#39;:memory:&#39;</span>        <span class="c1">#: :meta private: The database path</span>
    <span class="n">row_filter_descr</span><span class="p">:</span>   <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span>  <span class="o">=</span> <span class="kc">None</span>              <span class="c1">#: :meta private: The row filter combines column values</span>
    <span class="n">is_synchron</span><span class="p">:</span>        <span class="nb">bool</span>        <span class="o">=</span> <span class="kc">False</span>             <span class="c1">#: :meta private: Used to reduce calls to do_select</span>
    <span class="n">navigation</span><span class="p">:</span>         <span class="n">TNavigation</span> <span class="o">=</span> <span class="n">TNavigation</span>
    <span class="nb">id</span><span class="p">:</span>                 <span class="nb">str</span>         <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Post init for a data class</span>
<span class="sd">        The value for self.format_types could be customized for own data type formatting</span>
<span class="sd">        The formatter sends size aad value of the column and receives the formatted string &quot;&quot;&quot;</span>
        <span class="c1"># Init the UserList and keep track on the table instances</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_index</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visible_items</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visible_items</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_descr</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">column_descr</span> <span class="o">=</span> <span class="p">[</span><span class="n">TTableColumn</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">x_inx</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">x_str</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="n">x_str</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">x_str</span><span class="p">),</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                                 <span class="k">for</span> <span class="n">x_inx</span><span class="p">,</span> <span class="n">x_str</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">column_names</span><span class="p">)]</span>

        <span class="n">x_cells</span>               <span class="o">=</span> <span class="p">[</span><span class="n">TTableCell</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">x_str</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">x_str</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">x_inx</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">x_str</span><span class="p">))</span> <span class="k">for</span> <span class="n">x_inx</span><span class="p">,</span> <span class="n">x_str</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">column_names</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header_row</span>       <span class="o">=</span> <span class="n">TTableRow</span><span class="p">(</span><span class="n">cells</span><span class="o">=</span><span class="n">x_cells</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;header&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">column_names_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">x_cell</span><span class="o">.</span><span class="n">value</span><span class="p">:</span> <span class="n">x_cell</span> <span class="k">for</span> <span class="n">x_cell</span> <span class="ow">in</span> <span class="n">x_cells</span><span class="p">}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_types</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">format_types</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;int&#39;</span><span class="p">:</span>      <span class="k">lambda</span> <span class="n">x_size</span><span class="p">,</span> <span class="n">x_val</span><span class="p">:</span> <span class="s1">&#39; {{:&gt;</span><span class="si">{}</span><span class="s1">}} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_size</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_val</span><span class="p">),</span>
                <span class="s1">&#39;str&#39;</span><span class="p">:</span>      <span class="k">lambda</span> <span class="n">x_size</span><span class="p">,</span> <span class="n">x_val</span><span class="p">:</span> <span class="s1">&#39; {{:&lt;</span><span class="si">{}</span><span class="s1">}} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_size</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_val</span><span class="p">),</span>
                <span class="s1">&#39;float&#39;</span><span class="p">:</span>    <span class="k">lambda</span> <span class="n">x_size</span><span class="p">,</span> <span class="n">x_val</span><span class="p">:</span> <span class="s1">&#39; {{:&gt;</span><span class="si">{}</span><span class="s1">.2}} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_size</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_val</span><span class="p">),</span>
                <span class="s1">&#39;datetime&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x_size</span><span class="p">,</span> <span class="n">x_val</span><span class="p">:</span> <span class="s1">&#39; {{:&gt;</span><span class="si">{}</span><span class="s1">}} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_size</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_val</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y, %H:%M:%S&quot;</span><span class="p">))}</span>

    <span class="k">def</span> <span class="nf">get_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TTableColumn</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;:meta private:&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="n">filterfalse</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x_cd</span><span class="p">:</span> <span class="n">x_cd</span><span class="o">.</span><span class="n">header</span> <span class="o">!=</span> <span class="n">column_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_descr</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">filter_clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;:meta private:</span>
<span class="sd">        Clear the filters and return to original output &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply_filter_column</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">filter_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row_filter_descr</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;:meta private:</span>
<span class="sd">        Set the row filter: Each inner list is joined with &#39;AND&#39;.</span>
<span class="sd">        The outer list joins the inner lists with &#39;OR&#39; &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row_filter_descr</span> <span class="o">=</span> <span class="n">row_filter_descr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_synchron</span>      <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="TTable.filter_columns">
<a class="viewcode-back" href="../../eezz.html#eezz.table.TTable.filter_columns">[docs]</a>
    <span class="k">def</span> <span class="nf">filter_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_names</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; The column_names is a dictionary with a set of keys as subset of TTable.column_names.</span>
<span class="sd">        The values are translated names to display in output. The order of the keys represents the order in the</span>
<span class="sd">        output.</span>
<span class="sd">        The filter is used to generate customized output. This function could also be used to reduce the number of</span>
<span class="sd">        visible columns</span>

<span class="sd">        :param column_names:    Map new names to a column, e.g. after translation</span>
<span class="sd">        :type  column_names:    Dict[str: str]</span>

<span class="sd">        Example:</span>

<span class="sd">        &gt;&gt;&gt; my_table = TTable(column_names=[&#39;FileName&#39;, &#39;Size&#39;], title=&#39;Directory&#39;)</span>
<span class="sd">        &gt;&gt;&gt; my_table.filter_columns(column_names={&#39;Size&#39;:&#39;Gre&#39;, &#39;FileName&#39;: &#39;Datei&#39;})</span>
<span class="sd">        &gt;&gt;&gt; row1 = my_table.append([&#39;.idea&#39;,        4096])</span>
<span class="sd">        &gt;&gt;&gt; row2 = my_table.append([&#39;directory.py&#39;, 1886])</span>
<span class="sd">        &gt;&gt;&gt; row3 = my_table.append([&#39;__init__.py&#39;,    37])</span>
<span class="sd">        &gt;&gt;&gt; row4 = my_table.append([&#39;__pycache__&#39;,  4096])</span>
<span class="sd">        &gt;&gt;&gt; debug_out = io.StringIO()</span>
<span class="sd">        &gt;&gt;&gt; my_table.print(file=debug_out)</span>
<span class="sd">        &gt;&gt;&gt; print(debug_out.getvalue()[:-1])</span>
<span class="sd">        Table: Directory</span>
<span class="sd">        | Gre | Datei        |</span>
<span class="sd">        |  4096 | .idea        |</span>
<span class="sd">        |  1886 | directory.py |</span>
<span class="sd">        |    37 | __init__.py  |</span>
<span class="sd">        |  4096 | __pycache__  |</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create a list of column index and a translation of the column header entry</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">column_names_filter</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">column_names_alias</span>  <span class="o">=</span> <span class="n">column_names</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">column_names</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">x_inx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_names_map</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">column_names_filter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_inx</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">column_descr</span><span class="p">[</span><span class="n">x_inx</span><span class="p">]</span><span class="o">.</span><span class="n">alias</span> <span class="o">=</span> <span class="n">y</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">column_descr</span><span class="p">[</span><span class="n">x_inx</span><span class="p">]</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_descr</span><span class="p">[</span><span class="n">x_inx</span><span class="p">]</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">apply_filter_column</span>       <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span></div>


<div class="viewcode-block" id="TTable.append">
<a class="viewcode-back" href="../../eezz.html#eezz.table.TTable.append">[docs]</a>
    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_row</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">attrs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">row_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="n">row_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">exists_ok</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TTableRow</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Appends a new row to the table. The new row can include custom attributes,</span>
<span class="sd">        a specified type, and a unique identifier. If `row_id` already exists in</span>
<span class="sd">        the table, the function will handle it based on the `exists_ok` parameter.</span>
<span class="sd">        Appropriate cell types, widths, and descriptors are determined and updated</span>
<span class="sd">        accordingly. The added row is indexed and stored within the table structure.</span>

<span class="sd">        :param  table_row:  List of values representing a single row in the table.</span>
<span class="sd">        :type   table_row:  list</span>
<span class="sd">        :param  attrs:      Optional dictionary of attributes for the table row.</span>
<span class="sd">        :type   attrs:      dict, optional</span>
<span class="sd">        :param  row_type:   Type of the row, default is &#39;body&#39;.</span>
<span class="sd">        :type   row_type:   str</span>
<span class="sd">        :param  row_id:     Unique identifier for the row. If not provided, defaults to the row index.</span>
<span class="sd">        :type   row_id:     str</span>
<span class="sd">        :param  exists_ok:  If True, allows appending of a row with an existing row_id without raising an exception.</span>
<span class="sd">        :type   exists_ok:  bool</span>
<span class="sd">        :return:            The newly created table row object.</span>
<span class="sd">        :rtype:             TTableRow</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># define the type with the first line inserted</span>
        <span class="n">x_inx</span>        <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">x_row_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">table_row</span><span class="p">]</span>
        <span class="n">x_row_descr</span>  <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x_row_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_descr</span><span class="p">))</span>

        <span class="c1"># Check for a valid row_id</span>
        <span class="k">if</span> <span class="n">row_id</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">row_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">x_inx</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">x_inx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table_index</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">x_cell</span><span class="p">,</span> <span class="n">x_descr</span> <span class="ow">in</span> <span class="n">x_row_descr</span><span class="p">:</span>
                <span class="n">x_descr</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">x_cell</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="c1"># Check if the row-id is unique</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_index</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">row_id</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">exists_ok</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">TTableException</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;InsertException: row-id already exists </span><span class="si">{</span><span class="n">table_row</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">row_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_index</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">row_id</span><span class="p">)</span>

        <span class="n">x_cells</span> <span class="o">=</span> <span class="p">[</span><span class="n">TTableCell</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">x_descr</span><span class="o">.</span><span class="n">header</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x_cell</span><span class="p">)),</span> <span class="n">value</span><span class="o">=</span><span class="n">x_cell</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">x_descr</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">x_descr</span><span class="o">.</span><span class="n">type</span><span class="p">)</span> <span class="k">for</span> <span class="n">x_cell</span><span class="p">,</span> <span class="n">x_descr</span> <span class="ow">in</span> <span class="n">x_row_descr</span><span class="p">]</span>
        <span class="n">x_row</span>   <span class="o">=</span> <span class="n">TTableRow</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">x_inx</span><span class="p">,</span> <span class="n">cells</span><span class="o">=</span><span class="n">x_cells</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">attrs</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">row_type</span><span class="p">,</span> <span class="n">row_id</span><span class="o">=</span><span class="n">row_id</span><span class="p">,</span> <span class="n">column_descr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">column_names</span><span class="p">)</span>

        <span class="c1"># Store the detail descriptions</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x_cells</span><span class="p">,</span> <span class="n">table_row</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">x</span><span class="o">.</span><span class="n">detail</span> <span class="o">=</span> <span class="n">y</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">UserList</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_index</span><span class="p">[</span><span class="n">row_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_row</span>

        <span class="k">for</span> <span class="n">x_cell</span><span class="p">,</span> <span class="n">x_descr</span> <span class="ow">in</span> <span class="n">x_row_descr</span><span class="p">:</span>
            <span class="n">x_descr</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x_cell</span><span class="p">)),</span> <span class="n">x_descr</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x_row</span></div>


<div class="viewcode-block" id="TTable.get_header_row">
<a class="viewcode-back" href="../../eezz.html#eezz.table.TTable.get_header_row">[docs]</a>
    <span class="k">def</span> <span class="nf">get_header_row</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TTableRow</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Retrieves the header row of a table, applying a filter to the columns if</span>
<span class="sd">        necessary. If the `apply_filter_column` attribute is set to True, selects</span>
<span class="sd">        the visible columns according to the order specified in `column_names_filter`</span>
<span class="sd">        and maps these columns to new names specified in `column_names_alias`.</span>

<span class="sd">        :return: The table header row, potentially filtered and with aliased column names, encapsulated in a `TTableRow` object.</span>
<span class="sd">        :rtype:  TTableRow</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_filter_column</span><span class="p">:</span>
            <span class="c1"># Select the visible columns in the desired order and map the new names</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">header_row</span><span class="o">.</span><span class="n">cells_filter</span> <span class="o">=</span> <span class="p">[</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header_row</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_names_filter</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_row</span><span class="o">.</span><span class="n">cells_filter</span><span class="p">:</span>
                <span class="n">x</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_names_alias</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_row</span></div>


<div class="viewcode-block" id="TTable.get_selected_row">
<a class="viewcode-back" href="../../eezz.html#eezz.table.TTable.get_selected_row">[docs]</a>
    <span class="k">def</span> <span class="nf">get_selected_row</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_row</span></div>


<div class="viewcode-block" id="TTable.get_next_values">
<a class="viewcode-back" href="../../eezz.html#eezz.table.TTable.get_next_values">[docs]</a>
    <span class="k">def</span> <span class="nf">get_next_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_filter</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">TTableRow</span><span class="p">],</span> <span class="nb">bool</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Iterates over rows in the dataset and yields a tuple of values for each</span>
<span class="sd">        row that matches the given search filter. The search filter is a callable</span>
<span class="sd">        that should return a boolean indicating whether a particular row matches</span>
<span class="sd">        the criteria.</span>

<span class="sd">        :param search_filter: A callable function that takes a TTableRow object</span>
<span class="sd">                        and returns a boolean indicating whether the row matches the criteria.</span>
<span class="sd">        :return: Tuple of values from each matched row.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x_row</span><span class="p">:</span> <span class="n">TTableRow</span>
        <span class="k">for</span> <span class="n">x_row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">search_filter</span><span class="p">(</span><span class="n">x_row</span><span class="p">):</span>
                <span class="k">yield</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x_value</span> <span class="k">for</span> <span class="n">x_value</span> <span class="ow">in</span> <span class="n">x_row</span><span class="o">.</span><span class="n">get_values_list</span><span class="p">())</span></div>


<div class="viewcode-block" id="TTable.on_select">
<a class="viewcode-back" href="../../eezz.html#eezz.table.TTable.on_select">[docs]</a>
    <span class="k">def</span> <span class="nf">on_select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TTableRow</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Updates the selected row in the table if a row with the given index</span>
<span class="sd">        exists. If the row exists, it sets the selected row to it and</span>
<span class="sd">        returns the row. If the row does not exist, it returns None.</span>

<span class="sd">        :param index:   The unique identifier for the table row that is to be selected.</span>
<span class="sd">        :return:        The selected table row if it exists, otherwise None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">selected_row</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_index</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selected_row</span> <span class="o">=</span> <span class="n">selected_row</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_row</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="TTable.do_select">
<a class="viewcode-back" href="../../eezz.html#eezz.table.TTable.do_select">[docs]</a>
    <span class="k">def</span> <span class="nf">do_select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">get_all</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">filter_descr</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Executes a SELECT statement on the SQLite database associated with the current</span>
<span class="sd">        object and retrieves data based on the specified filter and options. The data</span>
<span class="sd">        can be fetched from an existing database or an in-memory table. Supports optional</span>
<span class="sd">        sorting and offset logic.</span>

<span class="sd">        The method allows focusing on retrieving either all records or a subset</span>
<span class="sd">        defined by internal pagination settings. It uses SQLite3 with Python&#39;s datetime</span>
<span class="sd">        support for converting date and time objects seamlessly. The method supports</span>
<span class="sd">        custom filtering through the `filter_descr` argument, which works with</span>
<span class="sd">        predefined column descriptions to create conditional where clauses.</span>

<span class="sd">        :param get_all: A boolean flag indicating whether to retrieve all records</span>
<span class="sd">                        from the database. If set to True, the method retrieves all available</span>
<span class="sd">                        data. If set to False, the method retrieves a limited number of records</span>
<span class="sd">                        based on the current pagination settings.</span>
<span class="sd">        :param filter_descr: A list of filters to be applied during the data selection.</span>
<span class="sd">                        These filters guide the construction of the SQL WHERE clause and determine</span>
<span class="sd">                        which records are included in the result set.</span>
<span class="sd">        :return:        A list containing the fetched records from the database. The records</span>
<span class="sd">                        fetched are determined by filter conditions or sorting and pagination</span>
<span class="sd">                        settings depending on the provided arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sqlite3</span><span class="o">.</span><span class="n">register_adapter</span><span class="p">(</span><span class="n">datetime</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x_val</span><span class="p">:</span> <span class="n">x_val</span><span class="o">.</span><span class="n">isoformat</span><span class="p">())</span>
        <span class="n">sqlite3</span><span class="o">.</span><span class="n">register_converter</span><span class="p">(</span><span class="s2">&quot;datetime&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x_val</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">x_val</span><span class="o">.</span><span class="n">decode</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_synchron</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">x_database</span>  <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database_path</span><span class="p">)</span>
        <span class="n">x_cursor</span>    <span class="o">=</span> <span class="n">x_database</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">x_ty_map</span>    <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;int&#39;</span><span class="p">:</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;float&#39;</span><span class="p">:</span> <span class="s1">&#39;real&#39;</span><span class="p">}</span>
        <span class="n">x_options</span>   <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">get_all</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39; limit </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">visible_items</span><span class="si">}</span><span class="s1"> offset </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">x_sorted</span>    <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">filterfalse</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x_col</span><span class="p">:</span> <span class="ow">not</span> <span class="n">x_col</span><span class="o">.</span><span class="n">sort</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_descr</span><span class="p">))</span>
        <span class="n">x_sort_stm</span>  <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_sorted</span><span class="p">:</span>
            <span class="n">x_sort_stm</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39; order by </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">header</span><span class="si">}</span><span class="s1"> ASC&#39;</span>
            <span class="k">break</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_path</span> <span class="o">==</span> <span class="s1">&#39;:memory:&#39;</span><span class="p">:</span>
            <span class="n">x_create_stm</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;create table </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">  (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">header</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">x_ty_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">type</span><span class="p">)</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">x_ty_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;text&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">column_descr</span><span class="p">)</span><span class="si">}</span><span class="s2">, index_key integer)&quot;&quot;&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;TTable.do_select: </span><span class="si">{</span><span class="n">x_create_stm</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">x_cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">x_create_stm</span><span class="p">)</span>

            <span class="n">x_insert_stm</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;insert into </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2"> values (</span><span class="si">{</span><span class="p">(</span><span class="s1">&#39;?,&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">column_names</span><span class="p">))</span><span class="si">}</span><span class="s2"> ?)&quot;&quot;&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;TTable.do_select: </span><span class="si">{</span><span class="n">x_insert_stm</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="n">x_row</span><span class="p">:</span> <span class="n">TTableRow</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x_row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
                <span class="n">x_cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">x_insert_stm</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x_row</span><span class="o">.</span><span class="n">get_values_list</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="n">x_database</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">filter_descr</span><span class="p">:</span>
            <span class="n">x_where</span><span class="p">,</span> <span class="n">x_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_filter</span><span class="p">(</span><span class="n">filter_descr</span><span class="p">)</span>
            <span class="n">x_select_stm</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;select * from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2"> where </span><span class="si">{</span><span class="n">x_where</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">x_sort_stm</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">x_options</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;TTable.do_select: </span><span class="si">{</span><span class="n">x_select_stm</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">x_cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">x_select_stm</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x_args</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;select * from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">x_options</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">yield from</span> <span class="n">x_cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span></div>


<div class="viewcode-block" id="TTable.create_filter">
<a class="viewcode-back" href="../../eezz.html#eezz.table.TTable.create_filter">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create_filter</span><span class="p">(</span><span class="n">filter_descr</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Constructs a SQL filter query and its corresponding arguments from a structured filter description.</span>
<span class="sd">        The filter description consists of nested lists representing conditions connected by logical &quot;and&quot; and &quot;or&quot;</span>
<span class="sd">        operators. Each condition within &quot;and&quot; is specified as a string with a column name, an operator, and a value.</span>

<span class="sd">        :param filter_descr: A list of lists where each inner list contains strings representing individual</span>
<span class="sd">                        conditions in the format &quot;&lt;column_name&gt; &lt;operator&gt; &lt;value&gt;&quot;.</span>
<span class="sd">        :type filter_descr: List[List[str]]</span>
<span class="sd">        :return:        A tuple containing the constructed SQL filter query as</span>
<span class="sd">                        a string and a list of arguments corresponding to the</span>
<span class="sd">                        placeholders in the SQL query.</span>
<span class="sd">        :rtype:         tuple</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x_where</span>     <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">x_args</span>      <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">x_or_list</span>   <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">x_or</span> <span class="ow">in</span> <span class="n">filter_descr</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x_and</span> <span class="ow">in</span> <span class="n">x_or</span><span class="p">:</span>
                <span class="n">x_column_name</span><span class="p">,</span> <span class="n">x_op</span><span class="p">,</span> <span class="n">x_value</span> <span class="o">=</span> <span class="n">x_and</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">x_where</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x_column_name</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">x_op</span><span class="si">}</span><span class="s1"> ?&#39;</span><span class="p">)</span>
                <span class="n">x_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_value</span><span class="p">)</span>
            <span class="n">x_or_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;(</span><span class="si">{</span><span class="s1">&#39; and &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x_where</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;&quot;&quot;</span><span class="p">)</span>
            <span class="n">x_where</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">return</span> <span class="s1">&#39; or &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x_or_list</span><span class="p">),</span> <span class="n">x_args</span></div>


<div class="viewcode-block" id="TTable.get_visible_rows">
<a class="viewcode-back" href="../../eezz.html#eezz.table.TTable.get_visible_rows">[docs]</a>
    <span class="k">def</span> <span class="nf">get_visible_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">get_all</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TTableRow</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Retrieves visible rows from the data source. The rows are filtered based</span>
<span class="sd">        on column descriptions and filter expressions, and can be further controlled</span>
<span class="sd">        by whether all rows should be retrieved or just a limited visible set.</span>

<span class="sd">        :param get_all: Determines whether to retrieve all rows without counting against the visible items limit.</span>
<span class="sd">                        Defaults to False.</span>
<span class="sd">        :type get_all:  bool</span>
<span class="sd">        :return:        A generator yielding visible rows that match the filter criteria.</span>
<span class="sd">        :rtype:         List[TTableRow]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># in case the filters is a string, we could also handle tree access</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">row_filter_descr</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_synchron</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x_selected</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_select</span><span class="p">(</span><span class="n">get_all</span><span class="o">=</span><span class="n">get_all</span><span class="p">,</span> <span class="n">filter_descr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">row_filter_descr</span><span class="p">):</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">x_selected</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">x_filter_row</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">x_col</span> <span class="ow">in</span> <span class="n">filterfalse</span><span class="p">(</span><span class="k">lambda</span> <span class="n">xx_col</span><span class="p">:</span> <span class="ow">not</span> <span class="n">xx_col</span><span class="o">.</span><span class="n">filter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_descr</span><span class="p">):</span>
            <span class="n">x_filter_row</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">x_col</span><span class="o">.</span><span class="n">header</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">x_col</span><span class="o">.</span><span class="n">filter</span><span class="p">)})</span>

        <span class="c1"># columns: List[str], values: List[str]</span>
        <span class="c1"># Apply the filter for column layout</span>
        <span class="n">x_count</span><span class="p">:</span> <span class="nb">int</span>  <span class="o">=</span> <span class="mi">0</span>
        <span class="n">x_start</span><span class="p">:</span> <span class="nb">int</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span>

        <span class="k">for</span> <span class="n">x_row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">x_start</span><span class="p">:]:</span>
            <span class="n">x_match</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">x_count</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">visible_items</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">get_all</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="k">for</span> <span class="n">x_key</span><span class="p">,</span> <span class="n">x_val</span> <span class="ow">in</span> <span class="n">x_filter_row</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">x_val</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x_row</span><span class="p">[</span><span class="n">x_key</span><span class="p">])):</span>
                    <span class="n">x_match</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">x_match</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">x_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">yield</span> <span class="n">x_row</span></div>


<div class="viewcode-block" id="TTable.navigate">
<a class="viewcode-back" href="../../eezz.html#eezz.table.TTable.navigate">[docs]</a>
    <span class="k">def</span> <span class="nf">navigate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">where_togo</span><span class="p">:</span> <span class="n">TNavigation</span> <span class="o">=</span> <span class="n">TNavigation</span><span class="o">.</span><span class="n">NEXT</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Adjusts the current navigation offset based on the specified navigation</span>
<span class="sd">        command and position. It calculates a new offset value for navigating</span>
<span class="sd">        within a data structure while ensuring that boundaries are respected.</span>
<span class="sd">        The offset determines the starting point for visible items and can be</span>
<span class="sd">        adjusted using different navigation strategies such as moving to the</span>
<span class="sd">        next, previous, absolute position, top, or last items in the structure.</span>

<span class="sd">        :param where_togo: Determines the navigation strategy. The navigation can be to the</span>
<span class="sd">                        &#39;NEXT&#39; item, &#39;PREV&#39; item, an &#39;ABS&#39;olute position, &#39;TOP&#39; of the data, or the &#39;LAST&#39; item.</span>
<span class="sd">        :param position: Used when the &#39;ABS&#39; navigation strategy is selected. Determines the target position for</span>
<span class="sd">                        the offset in the data structure.</span>
<span class="sd">        :return:        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">match</span> <span class="n">where_togo</span><span class="p">:</span>
            <span class="k">case</span> <span class="n">TNavigation</span><span class="o">.</span><span class="n">NEXT</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">visible_items</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">visible_items</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">case</span> <span class="n">TNavigation</span><span class="o">.</span><span class="n">PREV</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">visible_items</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">case</span> <span class="n">TNavigation</span><span class="o">.</span><span class="n">ABS</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">position</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">visible_items</span><span class="p">))</span>
            <span class="k">case</span> <span class="n">TNavigation</span><span class="o">.</span><span class="n">TOP</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">case</span> <span class="n">TNavigation</span><span class="o">.</span><span class="n">LAST</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">visible_items</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_synchron</span> <span class="o">=</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="TTable.do_sort">
<a class="viewcode-back" href="../../eezz.html#eezz.table.TTable.do_sort">[docs]</a>
    <span class="k">def</span> <span class="nf">do_sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">reverse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TTable</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Sorts the table by a specified column. This method allows sorting in</span>
<span class="sd">        ascending or descending order based on the `reverse` flag. The column to</span>
<span class="sd">        be sorted can be specified using either its index or name.</span>

<span class="sd">        :param column:  The column by which the table should be sorted. It can be</span>
<span class="sd">                        specified as an integer (index) or a string (name).</span>
<span class="sd">        :type column:   int | str</span>
<span class="sd">        :param reverse: Determines the order of sorting. If True, the table is</span>
<span class="sd">                        sorted in descending order; otherwise, it is sorted in</span>
<span class="sd">                        ascending order. Default is False.</span>
<span class="sd">        :type reverse:  bool</span>
<span class="sd">        :return:        The sorted table object.</span>
<span class="sd">        :rtype:         TTable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x_row</span><span class="p">:</span> <span class="n">x_row</span><span class="p">[</span><span class="n">column</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="TTable.print">
<a class="viewcode-back" href="../../eezz.html#eezz.table.TTable.print">[docs]</a>
    <span class="k">def</span> <span class="nf">print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Prints the table with the specified formatting and indentation level. The table</span>
<span class="sd">        headers are determined based on the column descriptions, and the rows are</span>
<span class="sd">        printed with respect to the visibility and formatting criteria applied. Each row</span>
<span class="sd">        can have a hierarchy with child rows being printed recursively at increasing</span>
<span class="sd">        indentation levels.</span>

<span class="sd">        :param level:   The indentation level to be applied to the printed table. Default is 0.</span>
<span class="sd">                        This affects the amount of whitespace before the table data, enhancing</span>
<span class="sd">                        readability for nested (child) tables.</span>
<span class="sd">        :param file:    An optional output stream to which the table will be printed. Default is</span>
<span class="sd">                        `sys.stdout`, which represents standard output.</span>
<span class="sd">        :return:        This function does not return any value. It directly prints the formatted</span>
<span class="sd">                        table to the specified output.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x_offset</span>        <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">level</span>
        <span class="n">x_column_descr</span>  <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">column_descr</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_names_filter</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_filter_column</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_descr</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x_offset</span><span class="si">}</span><span class="s1">Table: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="n">x_formatted_row</span> <span class="o">=</span> <span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39; {{:&lt;</span><span class="si">{}</span><span class="s1">}} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_col</span><span class="o">.</span><span class="n">width</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_col</span><span class="o">.</span><span class="n">alias</span><span class="p">)</span>  <span class="k">for</span> <span class="n">x_col</span> <span class="ow">in</span> <span class="n">x_column_descr</span><span class="p">])</span>  <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_filter_column</span> <span class="k">else</span> <span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39; {{:&lt;</span><span class="si">{}</span><span class="s1">}} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_col</span><span class="o">.</span><span class="n">width</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_col</span><span class="o">.</span><span class="n">header</span><span class="p">)</span> <span class="k">for</span> <span class="n">x_col</span> <span class="ow">in</span> <span class="n">x_column_descr</span><span class="p">]))</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x_offset</span><span class="si">}</span><span class="s1">|</span><span class="si">{</span><span class="n">x_formatted_row</span><span class="si">}</span><span class="s1">|&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">x_row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_visible_rows</span><span class="p">():</span>
            <span class="n">x_cells</span>         <span class="o">=</span> <span class="p">[</span><span class="n">x_row</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_names_filter</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_filter_column</span> <span class="k">else</span> <span class="n">x_row</span><span class="o">.</span><span class="n">cells</span>
            <span class="n">x_row_descr</span>     <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x_cells</span><span class="p">,</span> <span class="n">x_column_descr</span><span class="p">)</span>
            <span class="n">x_format_descr</span>  <span class="o">=</span> <span class="p">[(</span><span class="n">x_descr</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">x_descr</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>     <span class="n">x_cell</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="n">x_descr</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_types</span> <span class="k">else</span> <span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">,</span>        <span class="n">x_descr</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">x_cell</span><span class="o">.</span><span class="n">value</span><span class="p">))</span> <span class="k">for</span> <span class="n">x_cell</span><span class="p">,</span> <span class="n">x_descr</span> <span class="ow">in</span> <span class="n">x_row_descr</span><span class="p">]</span>

            <span class="n">x_formatted_row</span> <span class="o">=</span> <span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">format_types</span><span class="p">[</span><span class="n">x_type</span><span class="p">](</span><span class="n">x_width</span><span class="p">,</span> <span class="n">x_value</span><span class="p">)</span> <span class="k">for</span> <span class="n">x_type</span><span class="p">,</span> <span class="n">x_width</span><span class="p">,</span> <span class="n">x_value</span> <span class="ow">in</span> <span class="n">x_format_descr</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x_offset</span><span class="si">}</span><span class="s1">|</span><span class="si">{</span><span class="n">x_formatted_row</span><span class="si">}</span><span class="s1">|&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">x_row</span><span class="o">.</span><span class="n">child</span><span class="p">:</span>
                <span class="n">x_row</span><span class="o">.</span><span class="n">child</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span></div>
</div>



<span class="k">def</span> <span class="nf">test_table</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;:meta private:&quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Create a table and read the directory with attribute: [File, Size, Access] and print&quot;</span><span class="p">)</span>
    <span class="n">x_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
    <span class="n">x_table</span> <span class="o">=</span> <span class="n">TTable</span><span class="p">(</span><span class="n">title</span><span class="o">=</span> <span class="s1">&#39;list_files&#39;</span><span class="p">,</span> <span class="n">column_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;File&#39;</span><span class="p">,</span> <span class="s1">&#39;Size&#39;</span><span class="p">,</span> <span class="s1">&#39;Access&#39;</span><span class="p">],</span> <span class="n">visible_items</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x_item</span> <span class="ow">in</span> <span class="n">x_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
        <span class="n">x_stat</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">x_item</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">x_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">x_stat</span><span class="o">.</span><span class="n">st_atime</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="n">x_table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x_item</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="n">x_stat</span><span class="o">.</span><span class="n">st_size</span><span class="p">,</span> <span class="n">x_time</span><span class="p">],</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">x_item</span><span class="p">},</span> <span class="n">row_id</span><span class="o">=</span><span class="n">x_item</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="c1"># Check if row_id works: These entries should be rejected</span>
    <span class="k">for</span> <span class="n">x_item</span> <span class="ow">in</span> <span class="n">x_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">x_stat</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">x_item</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">x_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">x_stat</span><span class="o">.</span><span class="n">st_atime</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
            <span class="n">x_table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x_item</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="n">x_stat</span><span class="o">.</span><span class="n">st_size</span><span class="p">,</span> <span class="n">x_time</span><span class="p">],</span> <span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">x_item</span><span class="p">},</span> <span class="n">row_id</span><span class="o">=</span><span class="n">x_item</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">TTableException</span> <span class="k">as</span> <span class="n">x_except</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Check row-id: Add entries with same row-id should be rejected&#39;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;TableInsertException </span><span class="si">{</span><span class="n">x_item</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">x_except</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">break</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;table header = </span><span class="si">{</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">x_table</span><span class="o">.</span><span class="n">get_header_row</span><span class="p">()</span><span class="o">.</span><span class="n">cells</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">debug_out</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="n">x_table</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">debug_out</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">debug_out</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;--- Output restricted on File and Size, change the position and translate the column names&quot;</span><span class="p">)</span>
    <span class="n">x_table</span><span class="o">.</span><span class="n">filter_columns</span><span class="p">({</span><span class="s1">&#39;Size&#39;</span><span class="p">:</span> <span class="s1">&#39;Gre&#39;</span><span class="p">,</span> <span class="s1">&#39;File&#39;</span><span class="p">:</span> <span class="s1">&#39;Datei&#39;</span><span class="p">})</span>
    <span class="n">debug_out</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="n">x_table</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">debug_out</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">debug_out</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;--- Sort for column Size&#39;</span><span class="p">)</span>
    <span class="n">x_table</span><span class="o">.</span><span class="n">apply_filter_column</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">x_table</span><span class="o">.</span><span class="n">do_sort</span><span class="p">(</span><span class="s1">&#39;Size&#39;</span><span class="p">)</span>
    <span class="n">x_table</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;--- Restrict number of visible items&#39;</span><span class="p">)</span>
    <span class="n">x_table</span><span class="o">.</span><span class="n">visible_items</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">debug_out</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="n">x_table</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">debug_out</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">debug_out</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;--- Navigate to next&#39;</span><span class="p">)</span>
    <span class="n">x_table</span><span class="o">.</span><span class="n">navigate</span><span class="p">(</span><span class="n">where_togo</span><span class="o">=</span><span class="n">TNavigation</span><span class="o">.</span><span class="n">NEXT</span><span class="p">)</span>
    <span class="n">debug_out</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="n">x_table</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">debug_out</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">debug_out</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>

    <span class="c1"># x_result = [x for x in x_table.do_select(get_all=True, filter_descr=[[&#39;Size &gt; 20000&#39;],[&#39;File like %py&#39;]])]</span>
    <span class="n">x_result</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_table</span><span class="o">.</span><span class="n">do_select</span><span class="p">(</span><span class="n">get_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">filter_descr</span><span class="o">=</span><span class="p">[[</span><span class="s2">&quot;Size &gt; 10000&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;File like %.py&quot;</span><span class="p">]])]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;--- result = </span><span class="si">{</span><span class="n">x_result</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">x_table</span><span class="o">.</span><span class="n">visible_items</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">x_table</span><span class="o">.</span><span class="n">filter_rows</span><span class="p">([[</span><span class="s2">&quot;Size &gt; 10000&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;File like %.py&quot;</span><span class="p">]])</span>
    <span class="n">x_table</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;:meta private:&quot;&quot;&quot;</span>
    <span class="n">TService</span><span class="o">.</span><span class="n">set_environment</span><span class="p">(</span><span class="n">root_path</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;C:\Users\alzer\Projects\github\eezz_full\webroot&#39;</span><span class="p">)</span>
    <span class="n">test_table</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Albert Zedlitz.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>